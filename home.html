<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aurora Point | Home</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #E1E1E1; color: #333; display: flex; flex-direction: column; align-items: center; }

        /* Topo Azul Oficial conforme a imagem */
        .top-bar { 
            background: #003366; color: white; padding: 12px 20px; 
            width: 100%; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 4px solid #002244;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .user-stats { font-size: 13px; font-weight: bold; text-align: right; }
        .stat-line { color: #FFD700; font-size: 14px; }

        /* Bot√£o + no Header */
        .btn-plus {
            width: 35px; height: 35px; background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer;
        }

        .container { padding: 25px; display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
        
        /* Cards Brancos Arredondados */
        .card { 
            background: white; border: 1px solid #CCC; padding: 15px; 
            border-radius: 12px; width: 100%; max-width: 320px; 
            text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .card img { width: 100%; border-radius: 8px; margin-bottom: 12px; border: 1px solid #EEE; }
        .card-title { display: block; font-weight: bold; margin-bottom: 8px; color: #003366; font-size: 20px; }
        
        /* Bot√µes Coloridos */
        .btn-play { width: 100%; background: #008000; color: white; border: none; padding: 14px; font-weight: bold; border-radius: 8px; cursor: pointer; font-size: 16px; box-shadow: 0 4px #005500; text-transform: uppercase; }
        .btn-blue { width: 100%; background: #003366; color: white; border: none; padding: 14px; font-weight: bold; border-radius: 8px; cursor: pointer; font-size: 16px; box-shadow: 0 4px #001a33; text-transform: uppercase; }
        
        .btn-logout { background: none; border: none; color: #CC0000; font-size: 13px; cursor: pointer; margin-top: 20px; font-weight: bold; text-decoration: underline; }

        /* Modal de Busca */
        #search-modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-box { background: white; width: 85%; max-width: 320px; border-radius: 12px; padding: 20px; }
        .search-row { display: flex; gap: 8px; margin-top: 10px; }
        .search-row input { flex: 1; padding: 10px; border: 1px solid #CCC; border-radius: 8px; }
        .btn-ok { background: #003366; color: white; border: none; padding: 0 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        .user-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #EEE; }
    </style>
</head>
<body>

    <header class="top-bar">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="btn-plus" onclick="openSearch()">+</div>
            <img src="https://i.postimg.cc/jScG67Yr/Design-sem-nome(1).png" width="70">
        </div>
        <div class="user-stats">
            <div id="display-name" style="font-size: 15px; margin-bottom: 4px;">Carregando...</div>
            <div class="stat-line">üéüÔ∏è <span id="user-tickets">0</span> | ‚≠ê <span id="user-points">0</span></div>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <img src="https://art.ngfiles.com/comments/739000/iu_739223_7577476.webp">
            <span class="card-title">Classic Crossroads</span>
            <button class="btn-play" onclick="location.href='playerscripts.html'">JOGAR</button>
        </div>

        <div class="card">
            <span class="card-title">Meus Amigos</span>
            <p style="font-size: 14px; margin-bottom: 15px; color: #666;">Confira quem est√° online.</p>
            <button class="btn-blue" onclick="location.href='friends.html'">VER AMIGOS</button>
        </div>

        <div class="card">
            <span class="card-title">Meu Avatar</span>
            <p style="font-size: 14px; margin-bottom: 15px; color: #666;">Personalize as cores do seu R6.</p>
            <button class="btn-blue" onclick="location.href='avatar.html'">EDITAR AVATAR</button>
        </div>

        <button class="btn-logout" onclick="logout()">Sair da Conta</button>
    </div>

    <div id="search-modal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; font-weight:bold; color:#003366;">
                <span>Adicionar Amigo</span>
                <span onclick="closeSearch()" style="cursor:pointer; color:red; padding: 5px;">X</span>
            </div>
            <div class="search-row">
                <input type="text" id="s-input" placeholder="Nome do usu√°rio...">
                <button class="btn-ok" onclick="search()">OK</button>
            </div>
            <div id="s-results" style="max-height: 200px; overflow-y: auto; margin-top: 15px;"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBvwC0_9DREMFIHFelYuc5RdfXz6bpo1JA",
            authDomain: "aurorapoint-a8a1e.firebaseapp.com",
            projectId: "aurorapoint-a8a1e",
            storageBucket: "aurorapoint-a8a1e.firebasestorage.app",
            messagingSenderId: "324340380415",
            appId: "1:324340380415:web:468fcca5188b539682d2ca"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Carrega dados REAIS do Firestore
        auth.onAuthStateChanged(user => {
            if (!user) { window.location.href = 'index.html'; }
            else {
                db.collection("users").doc(user.uid).get().then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('display-name').innerText = "Ol√°, " + (data.username || "Jogador");
                        document.getElementById('user-tickets').innerText = data.tickets || 0;
                        document.getElementById('user-points').innerText = data.points || 0;
                    }
                });
            }
        });

        function openSearch() { document.getElementById('search-modal').style.display = 'flex'; }
        function closeSearch() { document.getElementById('search-modal').style.display = 'none'; }

        async function search() {
            const val = document.getElementById('s-input').value.toLowerCase().trim();
            const res = document.getElementById('s-results');
            if(val.length < 2) return alert("Digite ao menos 2 letras");

            res.innerHTML = "<p style='text-align:center; font-size:12px;'>Buscando...</p>";
            const snap = await db.collection("users").get();
            res.innerHTML = "";
            
            snap.forEach(doc => {
                const u = doc.data();
                if(doc.id !== auth.currentUser.uid && (u.username||'').toLowerCase().includes(val)) {
                    res.innerHTML += `
                        <div class="user-item">
                            <span style="font-weight:bold; color:#003366;">${u.username}</span>
                            <button onclick="add('${doc.id}', this)" style="background:#008000; color:white; border:none; padding:6px 12px; border-radius:5px; font-weight:bold; cursor:pointer;">ADD</button>
                        </div>`;
                }
            });
        }

        async function add(id, btn) {
            btn.innerText = "...";
            await db.collection("users").doc(auth.currentUser.uid).collection("friends").doc(id).set({ status: "friend" });
            btn.innerText = "‚úì";
            btn.style.background = "#666";
        }

        function logout() { auth.signOut().then(() => { window.location.href = 'index.html'; }); }
    </script>
</body>
</html>
